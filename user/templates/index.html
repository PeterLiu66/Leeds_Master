{% extends 'base.html' %}
{% load static %}
{% block content %}
    <div class="banner" style="position: fixed;top: 100px;left: 50px">
    <ul class="pic1" style="overflow: hidden;width: 310px;float: left">
        <!--淡入淡出banner-->
        <li><a href="javascript:void(0);"><img src="" alt="test"></a></li>
        <li><a href="javascript:void(0);"><img src="" alt="test"></a></li>
        <li><a href="javascript:void(0);"><img src="" alt="test"></a></li>
        <li><a href="javascript:void(0);"><img src="" alt="test"></a></li>
        <li><a href="javascript:void(0);"><img src="" alt="test"></a></li>
        <li><a href="javascript:void(0);"><img src="" alt="test"></a></li>
    </ul>
    <a href="javascript:void(0);" class="btn prev">
        <i class="PyWhich py-arrow-left"></i></a>
    <a href="javascript:void(0);" class="btn next">
        <i class="PyWhich py-arrow-right"></i></a>
    <ul class="tab">
        <!-- 按钮数量必须和图片一致 -->
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
    </ul>
</div>
    <script>
    fn_load_banner()
    // 轮播图
    let $banner = $(".banner");
    let $picLi = $(".banner .pic1 li");
    let $prev = $(".banner .prev");
    let $next = $(".banner .next");
    let $tabLi = $(".banner .tab li");
    let index = 0;

    // 小圆点点击事件
    $tabLi.click(function () {
        index = $(this).index();
        $(this).addClass("active").siblings("li").removeClass("active");
        $picLi.eq(index).fadeIn(1500).siblings("li").fadeOut(1500);
    });
    // 点击切换上一张
    $prev.click(function () {
        index--;
        if(index < 0){
            index = $tabLi.length - 1;
        }
        $tabLi.eq(index).addClass("active").siblings("li").removeClass("active");
        $picLi.eq(index).fadeIn(1500).siblings("li").fadeOut(1500);

    }).mousedown(function () {
        return false;
    });

    // 点击切换下一张
    $next.click(auto).mousedown(function(){
        return false;
    })

    function auto(){
        index ++;
        index %= $tabLi.length;
        $tabLi.eq(index).addClass("active").siblings("li").removeClass("active");
        $picLi.eq(index).fadeIn(1500).siblings("li").fadeOut(1500);
    }

    // 定时器
    auto()
    let timer = setInterval(auto, 5000);
   {% comment %} $banner.hover(function () {
        clearInterval(timer);
    }, function () {
        auto();
    });{% endcomment %}
    {{ tag.movie_set.all }}
    function fn_load_banner(){

                let res = {{ res|safe }}
                let content = ``;
                let tab_content = ``;
                $(".pic1").html("");
                $(".tab").html("");
                res.forEach(function(one_banner, index){
                    // console.log(one_banner);
                    if(index === 0){
                        console.log(one_banner);
                        content = `
                        <li style="display:block;"><a href="/news/${one_banner.news_id}/">
             <img src="${one_banner.image_url}" alt="${one_banner.news_title}"></a></li>
                        `;
                        tab_content = `
                        <li class="active"></li>
                        `
                    }
                    else{
                        console.log(one_banner);
                        content = `
                        <li><a href="/movie/${one_banner.news_id}/" target="_blank"><img src="${one_banner.image_url}" alt="${one_banner.news_title}"></a></li>
                        `
                        tab_content = `
                        <li></li>
                        `
                    }
                    $(".pic1").append(content);
                    $(".tab").append(tab_content);
                })


    }
    </script>
    <div>
        <ul class="nav nav-tabs nav-justified" id="index">
            <li class="active"><a id="hotest" href="#tab6" data-toggle="tab">Hot List</a></li>

                <li><a href="#tab0" data-toggle="tab">Classics</a></li>

                <li><a href="#tab1" data-toggle="tab">Crime</a></li>

                <li><a href="#tab2" data-toggle="tab">Romance</a></li>

                <li><a href="#tab3" data-toggle="tab">Cult</a></li>

                <li><a href="#tab4" data-toggle="tab">Action</a></li>

        </ul>
    </div>
    <div id="app2">
        <div class="tab-content" id="my-content">
            {% verbatim app2 %}

                <div class="tab-pane fade active in" id="tab6">
                    <div class="row">
                        <div v-for="movie in movies" class="col-md-3" style="height: 330px">
                            <a _boss="film" :href="'/movie/'+movie.id" target="_blank" class="figure" tabindex="-1">
                                <img  class="img-responsive img-rounded" :src="movie.image_link">
                            </a>
                            <strong>
                                <a _boss="film" style="overflow: hidden" :href="'/movie/'+movie.id" target="_blank" :title="movie.name">{{ movie.name }}</a>
                            </strong>
                        </div>
                    </div>
                </div>

            {% endverbatim app2 %}
            {% for tag in tags|slice:'0:5' %}
                <div class="tab-pane fade in" id="tab{{ forloop.counter0 }}">
                    <div class="row">
                        {% for movie in tag.movie_set.all|slice:'1:10' %}
                            <div class="col-md-3" style="height: 330px">
                                <a _boss="film" href="/movie/{{ movie.id }}" target="_blank" class="figure" tabindex="-1">
                                    <img class="img-responsive img-rounded" width="190px" height="270px" src="/media/{{ movie.image_link }}" alt="{{ movie.name }}">
                                </a>
                                <strong>
                                    <a _boss="film" style="overflow: hidden" href="/movie/{{ movie.id }}" target="_blank" title="{{ movie.name }}">{{ movie.name }}</a>
                                </strong>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
{% endblock %}
{% block rightside %}
{% endblock %}
{% block js %}
    <script>
               var app2 = new Vue({
                        el: '#app2',
                        data: {
                            movies: []
                        },
                        created: function () {
                            axios.get('/api/hotest_movie').then(function (res) {
                                app2.movies = res.data;
                            }).catch(function (error) {
                                console.log(error);
                            });
                        },
                    });
    </script>
{% endblock %}